# Credentials for J. Credential plugin is required
credentials:
  system:
    domainCredentials:
    - credentials:
      - basicSSHUserPrivateKey:
          scope: SYSTEM
          id: ssh_vagrant_worker_without_passphrase
          username: vagrant
          privateKeySource:
            directEntry:
              privateKey: "${readFile:${SSH_PRIVATE_FILE_PATH}}"
      - string:
          id: gh-token
          scope: GLOBAL
          secret: ${GITHUB_TOKEN}
      - usernamePassword:
          id: docker-creds
          scope: GLOBAL
          username: ${DOCKER_USR}
          password: ${DOCKER_PSW}

jenkins:
  numExecutors: 0
  mode: NORMAL
  scmCheckoutRetryCount: 3
  labelString: 'master-label'
  # Grant permissions
  authorizationStrategy:
    globalMatrix:
      permissions:
        - "USER:Overall/Read:anonymous"
        - "GROUP:Overall/Administer:authenticated"

  # Add config for authentication
  securityRealm:
    local:
      allowsSignup: false
      users:
        - id: ${ADMIN_USER}
          password: ${ADMIN_PW}

  nodes:
    - permanent:
        name: 'vagrant-worker'
        labelString: 'linux docker'
        mode: NORMAL
        remoteFS: '/home/vagrant'
        launcher:
          ssh:
            host: "192.168.56.11"
            port: 22
            credentialsId: ssh_vagrant_worker_without_passphrase
            sshHostKeyVerificationStrategy: "nonVerifyingKeyVerificationStrategy"
   
  # Fix security problems in Jenkins
  crumbIssuer:
    standard:
      excludeClientIPFromCrumb: false
  
  remotingSecurity:
    enabled: true

# Test job
jobs:
  - file: /var/jenkins_conf/jobs/seedJob.groovy
  - file: /var/jenkins_conf/jobs/seedJobCps.groovy

unclassified:
  location:
    adminAddress: ${ADMIN_EMAIL}
    url: http://192.168.56.10:8080/
  
  gitHubPluginConfig:
    configs:
    - credentialsId: gh-token
      name: 'step-project-2'
      manageHooks: true
